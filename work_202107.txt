Refactor database queries
Fix bug in authentication
