Fix edge case
Refactor database queries
Add tests
Update documentation
