Fix edge case
Refactor database queries
