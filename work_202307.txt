Fix bug in authentication
Clean up code
Refactor database queries
