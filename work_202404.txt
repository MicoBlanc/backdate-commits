Fix bug in authentication
Refactor database queries
