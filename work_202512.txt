Fix edge case
Improve error handling
Add logging
