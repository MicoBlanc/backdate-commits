Fix edge case
Improve error handling
Add logging
Clean up code
Refactor database queries
Add logging
